{"ast":null,"code":"var _jsxFileName = \"/home/hubertyu/Code/FirebaseCloudMessagePush/fcm_react_node/src/register/App.js\";\nimport React from 'react';\nimport { askForPermissioToReceiveNotifications } from './push-notification';\nimport { checkTopics } from './components/check_topics';\nimport showDescriptions from './components/show_description';\nimport ShowDrawer from './components/show_drawer';\nimport { Switch } from 'antd';\nimport 'antd/dist/antd.css';\nimport './index.css';\nimport { message } from 'antd';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleClick = id => {\n      var xmlHttp = new XMLHttpRequest();\n      var toggleStatus = [...this.state.toggle];\n      var data = JSON.stringify({\n        \"topic\": toggleStatus[id].id,\n        \"token\": this.state.token\n      });\n\n      if (toggleStatus[id].status === 'true') {\n        xmlHttp.open(\"POST\", 'https://nodejs.singtao.ca:8080/unsubscribe'); // false for synchronous request\n\n        xmlHttp.setRequestHeader(\"Content-Type\", \"application/json\");\n        xmlHttp.send(data);\n\n        xmlHttp.onreadystatechange = function () {\n          if (this.readyState === 4 && this.status === 200) {\n            var res = JSON.parse(xmlHttp.response);\n\n            if (res.status === \"SUCCESS\") {\n              message.warning(res.message);\n            } else {\n              message.error(res.message);\n            }\n          }\n        };\n\n        toggleStatus[id].status = '';\n        this.setState({\n          toggleStatus\n        });\n      } else {\n        xmlHttp.open(\"POST\", 'https://nodejs.singtao.ca:8080/subscribe'); // false for synchronous request\n\n        xmlHttp.setRequestHeader(\"Content-Type\", \"application/json\");\n        xmlHttp.send(data);\n\n        xmlHttp.onreadystatechange = function () {\n          if (this.readyState === 4 && this.status === 200) {\n            var res = JSON.parse(xmlHttp.response);\n\n            if (res.status === \"SUCCESS\") {\n              message.success(res.message);\n            } else {\n              message.error(res.message);\n            }\n          }\n        };\n\n        toggleStatus[id].status = 'true';\n        this.setState({\n          toggleStatus\n        });\n      }\n\n      ;\n    };\n\n    this.state = {\n      permission: '',\n      token: '',\n      topic: {},\n      toggle: [{\n        id: 'notifyTest1',\n        status: ''\n      }, {\n        id: 'notifyTest2',\n        status: ''\n      }, {\n        id: 'notifyTest3',\n        status: ''\n      }, {\n        id: 'notifyTest4',\n        status: ''\n      }]\n    };\n  }\n\n  componentDidMount() {\n    let self = this;\n    var toggleStatus = [...self.state.toggle];\n\n    if (!localStorage.getItem(\"permission\")) {\n      showDescriptions().then(function (permission) {\n        if (JSON.parse(permission).permission === 'sure') {\n          askForPermissioToReceiveNotifications().then(function (result) {\n            if (JSON.parse(result).permission) {\n              self.setState({\n                permission: 'NO'\n              });\n            } else {\n              self.setState({\n                token: JSON.parse(result).token\n              });\n\n              if (JSON.parse(result).token) {\n                //check the info of all topics\n                checkTopics(JSON.parse(result).token).then(function (result) {\n                  var res = JSON.parse(result);\n\n                  if (res.status === \"SUCCESS\") {\n                    if (res.message.rel) {\n                      self.setState({\n                        topic: res.message.rel.topics\n                      });\n                      Object.keys(res.message.rel.topics).map(function (key, index) {\n                        switch (key) {\n                          case 'notifyTest1':\n                            toggleStatus[0].status = true;\n                            self.setState({\n                              toggleStatus\n                            });\n                            break;\n\n                          case 'notifyTest2':\n                            toggleStatus[1].status = true;\n                            self.setState({\n                              toggleStatus\n                            });\n                            break;\n\n                          case 'notifyTest3':\n                            toggleStatus[2].status = true;\n                            self.setState({\n                              toggleStatus\n                            });\n                            break;\n\n                          case 'notifyTest4':\n                            toggleStatus[3].status = true;\n                            self.setState({\n                              toggleStatus\n                            });\n                            break;\n\n                          default:\n                        }\n                      });\n                    } else {\n                      self.setState({\n                        topic: res.message.rel\n                      });\n                    }\n                  } else {\n                    console.log(res.message);\n                  }\n                });\n              }\n            }\n          });\n        } else {\n          console.log('redirection');\n        }\n      });\n    } else {\n      askForPermissioToReceiveNotifications().then(function (result) {\n        if (JSON.parse(result).permission) {\n          self.setState({\n            permission: 'NO'\n          });\n        } else {\n          self.setState({\n            token: JSON.parse(result).token\n          });\n\n          if (JSON.parse(result).token) {\n            //check the info of all topics\n            checkTopics(JSON.parse(result).token).then(function (result) {\n              var res = JSON.parse(result);\n\n              if (res.status === \"SUCCESS\") {\n                if (res.message.rel) {\n                  self.setState({\n                    topic: res.message.rel.topics\n                  });\n                  Object.keys(res.message.rel.topics).map(function (key, index) {\n                    switch (key) {\n                      case 'notifyTest1':\n                        toggleStatus[0].status = 'true';\n                        self.setState({\n                          toggleStatus\n                        });\n                        break;\n\n                      case 'notifyTest2':\n                        toggleStatus[1].status = 'true';\n                        self.setState({\n                          toggleStatus\n                        });\n                        break;\n\n                      case 'notifyTest3':\n                        toggleStatus[2].status = 'true';\n                        self.setState({\n                          toggleStatus\n                        });\n                        break;\n\n                      case 'notifyTest4':\n                        toggleStatus[3].status = 'true';\n                        self.setState({\n                          toggleStatus\n                        });\n                        break;\n\n                      default:\n                    }\n                  });\n                } else {\n                  self.setState({\n                    topic: res.message.rel\n                  });\n                }\n              } else {\n                console.log(res.message);\n              }\n            });\n          }\n        }\n      });\n    }\n  }\n\n  render() {\n    console.log(this.state);\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"title\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      className: \"titleTopic\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 13\n      }\n    }, \"Topic\"), /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 13\n      }\n    }, \"Subscribe\")), this.state.permission === 'NO' ? /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"subscribe\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 17\n      }\n    }, \"notifyTest1\"), /*#__PURE__*/React.createElement(Switch, {\n      disabled: \"true\",\n      style: {\n        marginLeft: '5%'\n      },\n      onClick: () => this.handleClick(0),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"subscribe\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 17\n      }\n    }, \"notifyTest2\"), /*#__PURE__*/React.createElement(Switch, {\n      disabled: \"true\",\n      style: {\n        marginLeft: '5%'\n      },\n      onClick: () => this.handleClick(1),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"subscribe\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 17\n      }\n    }, \"notifyTest3\"), /*#__PURE__*/React.createElement(Switch, {\n      disabled: \"true\",\n      style: {\n        marginLeft: '5%'\n      },\n      onClick: () => this.handleClick(2),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"subscribe\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 17\n      }\n    }, \"notifyTest4\"), /*#__PURE__*/React.createElement(Switch, {\n      disabled: \"true\",\n      style: {\n        marginLeft: '5%'\n      },\n      onClick: () => this.handleClick(3),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(ShowDrawer, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 15\n      }\n    })) : /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"subscribe\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 9\n      }\n    }, \"notifyTest1\"), /*#__PURE__*/React.createElement(Switch, {\n      checked: this.state.toggle[0].status,\n      style: {\n        marginLeft: '5%'\n      },\n      onClick: () => this.handleClick(0),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"subscribe\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 9\n      }\n    }, \"notifyTest2\"), /*#__PURE__*/React.createElement(Switch, {\n      checked: this.state.toggle[1].status,\n      style: {\n        marginLeft: '5%'\n      },\n      onClick: () => this.handleClick(1),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"subscribe\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 9\n      }\n    }, \"notifyTest3\"), /*#__PURE__*/React.createElement(Switch, {\n      checked: this.state.toggle[2].status,\n      style: {\n        marginLeft: '5%'\n      },\n      onClick: () => this.handleClick(2),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"subscribe\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 9\n      }\n    }, \"notifyTest4\"), /*#__PURE__*/React.createElement(Switch, {\n      checked: this.state.toggle[3].status,\n      style: {\n        marginLeft: '5%'\n      },\n      onClick: () => this.handleClick(3),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 9\n      }\n    }))));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/home/hubertyu/Code/FirebaseCloudMessagePush/fcm_react_node/src/register/App.js"],"names":["React","askForPermissioToReceiveNotifications","checkTopics","showDescriptions","ShowDrawer","Switch","message","App","Component","constructor","props","handleClick","id","xmlHttp","XMLHttpRequest","toggleStatus","state","toggle","data","JSON","stringify","token","status","open","setRequestHeader","send","onreadystatechange","readyState","res","parse","response","warning","error","setState","success","permission","topic","componentDidMount","self","localStorage","getItem","then","result","rel","topics","Object","keys","map","key","index","console","log","render","marginLeft"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { askForPermissioToReceiveNotifications } from './push-notification';\nimport { checkTopics } from './components/check_topics';\nimport  showDescriptions from './components/show_description';\nimport ShowDrawer from './components/show_drawer';\nimport { Switch } from 'antd';\nimport 'antd/dist/antd.css';\nimport './index.css';\nimport { message } from 'antd';\n\nclass App extends React.Component {\n    constructor(props) {\n      super(props);\n      this.state = {\n        permission:'',\n        token:'',\n        topic:{},\n        toggle:[\n          {id:'notifyTest1',status:''},\n          {id:'notifyTest2',status:''},\n          {id:'notifyTest3',status:''},\n          {id:'notifyTest4',status:''}\n        ]\n      }\n    }\n\n    componentDidMount () {\n      let self=this;\n      var toggleStatus = [...self.state.toggle];\n      if(!localStorage.getItem(\"permission\")){\n        showDescriptions().then(function(permission){\n          if(JSON.parse(permission).permission==='sure'){\n              askForPermissioToReceiveNotifications().then(function(result){\n                if(JSON.parse(result).permission){\n                  self.setState({ permission:'NO' })\n                } else {\n                self.setState({ token:JSON.parse(result).token });\n                    \n                if(JSON.parse(result).token) {\n                  //check the info of all topics\n                  checkTopics(JSON.parse(result).token).then(function(result){\n                    var res = JSON.parse(result);\n                    if(res.status===\"SUCCESS\") {\n                      if(res.message.rel){\n                        self.setState({topic:res.message.rel.topics});\n                                  \n                        Object.keys(res.message.rel.topics).map(function(key,index){\n                          switch(key) {\n                          case 'notifyTest1' :\n                            toggleStatus[0].status = true;\n                            self.setState({ toggleStatus});\n                            break;\n                          case 'notifyTest2' :\n                            toggleStatus[1].status = true;\n                            self.setState({ toggleStatus});\n                            break;\n                          case 'notifyTest3' :\n                            toggleStatus[2].status = true;\n                            self.setState({ toggleStatus});\n                            break;\n                          case 'notifyTest4' :\n                            toggleStatus[3].status = true;\n                            self.setState({ toggleStatus});\n                            break;\n                            default:\n                          }\n                        })\n                      } else {\n                        self.setState({topic:res.message.rel})\n                      }\n                    } else {\n                      console.log(res.message)\n                    }\n                  })\n                  }\n                }\n              });\n            } else {\n               console.log('redirection');\n            }\n          });\n        } else {\n            askForPermissioToReceiveNotifications().then(function(result){\n              if(JSON.parse(result).permission){\n                self.setState({ permission:'NO' })\n              } else {\n              self.setState({ token:JSON.parse(result).token });\n                  \n              if(JSON.parse(result).token) {\n                //check the info of all topics\n                checkTopics(JSON.parse(result).token).then(function(result){\n                  var res = JSON.parse(result);\n                  if(res.status===\"SUCCESS\") {\n                    if(res.message.rel){\n                      self.setState({topic:res.message.rel.topics});\n                                \n                      Object.keys(res.message.rel.topics).map(function(key,index){\n                        switch(key) {\n                        case 'notifyTest1' :\n                          toggleStatus[0].status = 'true';\n                          self.setState({ toggleStatus});\n                          break;\n                        case 'notifyTest2' :\n                          toggleStatus[1].status = 'true';\n                          self.setState({ toggleStatus});\n                          break;\n                        case 'notifyTest3' :\n                          toggleStatus[2].status = 'true';\n                          self.setState({ toggleStatus});\n                          break;\n                        case 'notifyTest4' :\n                          toggleStatus[3].status = 'true';\n                          self.setState({ toggleStatus});\n                          break;\n                          default:\n                        }\n                      })\n                    } else {\n                      self.setState({topic:res.message.rel})\n                    }\n                  } else {\n                    console.log(res.message)\n                  }\n                })\n                }\n              }\n              });\n          }\n        }\n\n    handleClick = (id) =>{\n      var xmlHttp = new XMLHttpRequest();\n      var toggleStatus = [...this.state.toggle];\n      var data = JSON.stringify({\n        \"topic\":toggleStatus[id].id,\n        \"token\":this.state.token\n      });\n      if(toggleStatus[id].status === 'true'){\n        xmlHttp.open( \"POST\",  'https://nodejs.singtao.ca:8080/unsubscribe'); // false for synchronous request\n        xmlHttp.setRequestHeader(\"Content-Type\", \"application/json\");\n        xmlHttp.send(data);\n        xmlHttp.onreadystatechange= function() {\n          if(this.readyState === 4 && this.status === 200){\n            var res = JSON.parse(xmlHttp.response);\n            if(res.status===\"SUCCESS\") {\n              message.warning(res.message);\n            } else {\n              message.error(res.message)\n            }\n          }\n        }\n        toggleStatus[id].status = '';\n        this.setState({ toggleStatus});\n      } else {\n          xmlHttp.open( \"POST\",  'https://nodejs.singtao.ca:8080/subscribe'); // false for synchronous request\n          xmlHttp.setRequestHeader(\"Content-Type\", \"application/json\");\n          xmlHttp.send(data);\n          xmlHttp.onreadystatechange= function() {\n            if(this.readyState === 4 && this.status === 200){\n              var res = JSON.parse(xmlHttp.response);\n              if(res.status===\"SUCCESS\") {\n                message.success(res.message);\n              } else {\n                message.error(res.message)\n              }\n            }\n          }\n        toggleStatus[id].status = 'true';\n        this.setState({ toggleStatus});\n      };\n    }\n  \n    render() {\nconsole.log(this.state);\n      return (\n        <React.Fragment>\n          <div className = \"title\">\n            <h1 className = 'titleTopic'>Topic</h1>\n            <h1>Subscribe</h1>\n          </div>\n          {this.state.permission==='NO' ? (\n            <React.Fragment>\n\n              <div className = 'subscribe'>\n                <h2>notifyTest1</h2>\n                <Switch disabled='true' style={{marginLeft:'5%'}} onClick={()=>this.handleClick(0)}/>\n              </div>\n              <div className = 'subscribe'>\n                <h2>notifyTest2</h2>\n                <Switch disabled='true' style={{marginLeft:'5%'}} onClick={()=>this.handleClick(1)}/>\n              </div>\n              <div className = 'subscribe'>\n                <h2>notifyTest3</h2>\n                <Switch disabled='true' style={{marginLeft:'5%'}} onClick={()=>this.handleClick(2)}/>\n              </div>\n              <div className = 'subscribe'>\n                <h2>notifyTest4</h2>\n                <Switch disabled='true' style={{marginLeft:'5%'}} onClick={()=>this.handleClick(3)}/>\n              </div>\n              <ShowDrawer />\n            </React.Fragment>\n      ) : (\n        <React.Fragment>\n        <div className = 'subscribe'>\n        <h2>notifyTest1</h2>\n        <Switch checked={this.state.toggle[0].status} style={{marginLeft:'5%'}} onClick={()=>this.handleClick(0)}/>\n      </div>\n      <div className = 'subscribe'>\n        <h2>notifyTest2</h2>\n        <Switch checked={this.state.toggle[1].status} style={{marginLeft:'5%'}} onClick={()=>this.handleClick(1)}/>\n      </div>\n      <div className = 'subscribe'>\n        <h2>notifyTest3</h2>\n        <Switch checked={this.state.toggle[2].status} style={{marginLeft:'5%'}} onClick={()=>this.handleClick(2)}/>\n      </div>\n      <div className = 'subscribe'>\n        <h2>notifyTest4</h2>\n        <Switch checked={this.state.toggle[3].status} style={{marginLeft:'5%'}} onClick={()=>this.handleClick(3)}/>\n      </div>\n      </React.Fragment>\n      )}  \n        </React.Fragment>\n      );\n    }\n  }\n\nexport default App;"]},"metadata":{},"sourceType":"module"}